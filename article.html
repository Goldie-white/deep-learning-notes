<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Article | MICKEY'S ML&MATH BLOG</title>
    
    <!-- Google Fonts for academic style -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                autoload: {
                    color: [],
                    colorv2: ['color']
                },
                packages: {'[+]': ['ams', 'newcommand', 'configmacros']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process',
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="navbar">
        <div class="container">
            <div class="navbar-content">
                <div class="logo-text"><a href="index.html" style="text-decoration: none; color: inherit;">MICKEY'S ML&MATH BLOG</a></div>
                <nav class="nav">
                    <a href="index.html#home" class="nav-link">Home</a>
                    <a href="about.html" class="nav-link">About</a>
                    <a href="index.html#architecture" class="nav-link">Architecture Notes</a>
                    <a href="index.html#papers" class="nav-link">Paper Reading</a>
                    <a href="index.html#notebook" class="nav-link">Lab Notebook</a>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <article class="article-page">
            <div class="container">
                <div id="articleContent">
                    <!-- Article content will be loaded here -->
                    <p>Loading article...</p>
                </div>
            </div>
        </article>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright">&copy; 2024 Mickey. All rights reserved.</p>
                <div class="social-links">
                    <a href="https://github.com" target="_blank" rel="noopener noreferrer" class="social-link">GitHub</a>
                    <a href="mailto:" class="social-link">Email</a>
                    <a href="https://scholar.google.com" target="_blank" rel="noopener noreferrer" class="social-link">Scholar</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Load article content based on URL parameter
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const articleId = parseInt(urlParams.get('id'));
            
            if (!articleId) {
                document.getElementById('articleContent').innerHTML = '<p>Article not found. <a href="index.html">Return to home</a></p>';
                return;
            }
            
            const article = articles.find(a => a.id === articleId);
            
            if (!article) {
                document.getElementById('articleContent').innerHTML = '<p>Article not found. <a href="index.html">Return to home</a></p>';
                return;
            }
            
            // Update page title
            document.title = article.title + ' | MICKEY\'S ML&MATH BLOG';
            
            // Render article header first
            const articleContent = document.getElementById('articleContent');
            articleContent.innerHTML = `
                <div class="article-header">
                    <span class="article-category">${categoryLabels[article.category]}</span>
                    <h1 class="article-title">${article.title}</h1>
                    <div class="article-meta">
                        <span class="article-date">üìÖ ${formatDate(article.date)}</span>
                        <span>‚è±Ô∏è ${article.readTime}</span>
                    </div>
                </div>
                <div class="article-body" id="articleBody">Loading...</div>
                <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <a href="index.html" style="color: var(--primary-color); text-decoration: none; font-family: 'Inter', sans-serif;">‚Üê Back to Articles</a>
                </div>
            `;
            
            const articleBody = document.getElementById('articleBody');
            
            // Load content from file if contentFile exists, otherwise use article.content
            async function loadArticleContent() {
                let content = article.content;
                
                // If article has contentFile, try to load from file
                if (article.contentFile) {
                    try {
                        const response = await fetch(article.contentFile);
                        if (response.ok) {
                            content = await response.text();
                        } else {
                            console.warn(`Failed to load ${article.contentFile}, using default content`);
                        }
                    } catch (e) {
                        console.warn(`Error loading ${article.contentFile}:`, e);
                    }
                }
                
                // Render markdown content
                articleBody.innerHTML = markdownToHtml(content);
                
                // Render MathJax
                renderMathJax();
            }
            
            // Wait for MathJax to be ready, then render
            function renderMathJax() {
                if (window.MathJax && window.MathJax.typesetPromise) {
                    window.MathJax.typesetPromise([articleBody]).then(() => {
                        console.log('MathJax rendering complete');
                    }).catch((err) => {
                        console.error('MathJax rendering error:', err);
                    });
                } else if (window.MathJax && window.MathJax.startup) {
                    // MathJax 3.x startup
                    window.MathJax.startup.document.state(0);
                    window.MathJax.typesetPromise([articleBody]).then(() => {
                        console.log('MathJax rendering complete');
                    }).catch((err) => {
                        console.error('MathJax rendering error:', err);
                    });
                } else {
                    // MathJax not loaded yet, wait a bit
                    setTimeout(renderMathJax, 100);
                }
            }
            
            // Load content
            loadArticleContent();
        });
    </script>
</body>
</html>

